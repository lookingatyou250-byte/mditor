# mditor 问题清单

> 整理自开发过程中发现的 Bug 和待优化项

---

## 🔴 已确认的 Bug

### 1. 斜杠命令 `//` 删除问题
**描述**: 选择格式后，`//` 没有完全删除，只删了一个 `/`

**根因分析**:
- 早期实现：两次 dispatch 导致位置计算错误
- v2.4.0 修复：改用 keyup 事件 + 单次 dispatch
- v2.5.0 修复：保存触发位置 `slashTriggerPos`，使用 input 事件 + setTimeout

**状态**: ✅ 已修复 (v2.5.0)

---

### 2. 斜杠命令需要空格才能触发
**描述**: 输入 `//` 不触发菜单，需要先输入空格再输入 `//`

**根因分析**:
- `keyup` 事件在 CodeMirror 中不可靠
- v2.5.0 改用 `input` 事件 + `setTimeout` 确保文档已更新

**状态**: ✅ 已修复 (v2.5.0)

---

### 3. 暗色模式不生效
**描述**: 点击主题切换按钮后，颜色不变化

**根因分析**:
- CSS 使用 `:root[data-theme="dark"]`
- JS 设置的是 `document.body.dataset.theme`
- 选择器不匹配

**修复**: 改为 `body[data-theme="dark"]`

**状态**: ✅ 已修复 (v2.2.2, v2.5.0 完善)

---

### 4. 窗口关闭报错
**描述**: 关闭窗口时报 "Object has been destroyed"

**根因分析**:
- 在 `closed` 事件中访问 `win.webContents.id`
- 但此时 webContents 已销毁

**修复**: 提前保存 `webContentsId`

**状态**: ✅ 已修复 (v2.2.1)

---

### 5. 自动保存后状态未更新
**描述**: 自动保存成功后，保存指示器状态未正确更新

**修复**: 在 `_autoSave()` 中添加 `hasUnsavedChanges = false` 和 `_updateSaveIndicator()`

**状态**: ✅ 已修复 (v2.5.0)

---

## 🟡 待验证功能

### 1. 文件树只显示 .md 文件
**需求**: Obsidian 风格，只显示 Markdown 文件和文件夹

**状态**: ✅ 已实现 (v2.5.0 验证)

---

### 2. 实时自动保存
**需求**: 2秒无操作自动保存

**实现**: `_scheduleAutoSave()` + `_autoSave()`

**状态**: ✅ 已实现 (v2.5.0 验证)

---

## 🔵 计划开发 (P2)

| 功能 | 描述 | 状态 |
|------|------|------|
| 内容区宽度自适应 | 响应窗口大小调整内容宽度 | ✅ 已完成 (v2.5.0) |
| 滚动条优化 | 悬停显示、样式美化 | ✅ 已完成 (v2.5.0) |
| Tab-nabbing 防护 | 外部链接安全处理 | ✅ 已实现 (rel="noopener noreferrer") |

---

## 📊 版本问题追踪

| 版本 | 问题 | 状态 |
|------|------|------|
| v2.2.1 | 窗口关闭报错 | ✅ 已修复 |
| v2.2.2 | 暗色模式不生效 | ✅ 已修复 |
| v2.2.3 | 斜杠命令重复初始化 | ✅ 已修复 |
| v2.3.0 | 改用 `//` 触发 | ✅ 已实现 |
| v2.3.1 | `//` 只删一个字符 | ⚠️ 部分修复 |
| v2.4.0 | 重写斜杠命令模块 | ⚠️ 部分修复 |
| v2.5.0 | 完全修复斜杠命令、自动保存、宽度自适应、滚动条优化 | ✅ 已完成 |

---

*Last Updated: 2026-01-18*
